recipe:
  # QNet Recipe - Dual-stream queueing network with parameterized connections
  # This recipe defines the using field connections declaratively rather than hardcoded

  parameters:
    prefix: "qnet"
    primary_count: 10000
    secondary_count: 7500
    primary_rate: 3.0
    secondary_rate: 4.0
    primary_service_time: 0.1
    secondary_service_time: 0.12
    final_service_time: 0.05

  wants:
    # Primary packet generator
    - metadata:
        name: "gen-primary"
        type: qnet numbers
        labels:
          role: source
          stream: primary
          priority: high
      spec:
        params:
          rate: primary_rate
          count: primary_count

    # Secondary packet generator
    - metadata:
        name: "gen-secondary"
        type: qnet numbers
        labels:
          role: source
          stream: secondary
          priority: medium
      spec:
        params:
          rate: secondary_rate
          count: secondary_count

    # Main queue processing primary stream
    - metadata:
        name: "queue-primary"
        type: qnet queue
        labels:
          role: processor
          stage: first
          stream: primary
          path: main
      spec:
        params:
          service_time: primary_service_time
        using:
          - role: source
            stream: primary

    # Alt queue processing secondary stream
    - metadata:
        name: "queue-secondary"
        type: qnet queue
        labels:
          role: processor
          stage: first
          stream: secondary
          path: alt
      spec:
        params:
          service_time: secondary_service_time
        using:
          - role: source
            stream: secondary

    # Stream combiner - connects to both first-stage processors
    - metadata:
        name: "combiner-main"
        type: qnet combiner
        labels:
          role: merger
          operation: combine
          stage: second
      spec:
        params: {}
        using:
          - role: processor
            stage: first

    # Final processing queue - connects to combiner
    - metadata:
        name: "queue-final"
        type: qnet queue
        labels:
          role: processor
          stage: final
          path: output
      spec:
        params:
          service_time: final_service_time
        using:
          - role: merger

    # Final collector - connects to final processor
    - metadata:
        name: "collector-end"
        type: qnet sink
        labels:
          role: terminal
          stage: end
      spec:
        params: {}
        using:
          - role: processor
            stage: final

  # Recipe result definition - specifies which want and stat to use for final result
  result:
      - want_name: "queue-primary"
        stat_name: ".average_wait_time"
        description: "Average wait time in primary stream queue"
      - want_name: "queue-secondary"
        stat_name: ".average_wait_time"
        description: "Average wait time in secondary stream queue"
      - want_name: "queue-final"
        stat_name: "."
        description: "All metrics in final queue"